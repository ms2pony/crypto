#include <stdio.h>
#include <immintrin.h>

unsigned long A[10] = {20982470, 65953693, 21914385, 49174405, 41543558, 1762678, 11052767, 48579851, 51383560, 3310613};

unsigned long B[10] = {3951798, 29668248, 30574297, 56605851, 49742749, 11577614, 57596360, 61420814, 7397846, 757517};

unsigned long T[10] = {0};

void mont_mul_opt(unsigned long **res)
{
    //-算出约减阶段最长依赖T9
    unsigned long R0,R1,R2,R3,R4,R5,R6,R7,R8,R9,R10,R11;

    R0=A[0]*B[0];
    R1=R0;
    R0=R1&67108863;
    R2=A[0]*B[1]+A[1]*B[0];
    R3=R2;
    R2=R3+(R1>>26);
    R1=R2&67108863;
    R3=A[0]*B[2]+A[1]*B[1]+A[2]*B[0];
    R4=R3+(R0<<12);
    R3=R4+(R2>>26);
    R2=R3&67108863;
    R4=A[0]*B[3]+A[1]*B[2]+A[2]*B[1]+A[3]*B[0];
    R5=R4-(R0<<18)+(R1<<12);
    R4=R5+(R3>>26);
    R3=R4&67108863;
    R5=A[0]*B[4]+A[1]*B[3]+A[2]*B[2]+A[3]*B[1]+A[4]*B[0];
    R6=R5-(R1<<18)+(R2<<12);
    R5=R6+(R4>>26);
    R4=R5&67108863;
    R6=A[0]*B[5]+A[1]*B[4]+A[2]*B[3]+A[3]*B[2]+A[4]*B[1]+A[5]*B[0];
    R7=R6-(R2<<18)+(R3<<12);
    R6=R7+(R5>>26);
    R5=R6&67108863;
    R7=A[0]*B[6]+A[1]*B[5]+A[2]*B[4]+A[3]*B[3]+A[4]*B[2]+A[5]*B[1]+A[6]*B[0];
    R8=R7-(R3<<18)+(R4<<12);
    R7=R8+(R6>>26);
    R6=R7&67108863;
    R8=A[0]*B[7]+A[1]*B[6]+A[2]*B[5]+A[3]*B[4]+A[4]*B[3]+A[5]*B[2]+A[6]*B[1]+A[7]*B[0];
    R9=R8-(R4<<18)+(R5<<12);
    R8=R9+(R7>>26);
    R7=R8&67108863;
    R9=A[0]*B[8]+A[1]*B[7]+A[2]*B[6]+A[3]*B[5]+A[4]*B[4]+A[5]*B[3]+A[6]*B[2]+A[7]*B[1]+A[8]*B[0];
    R10=R9-(R0<<16)-(R5<<18)+(R6<<12);
    R9=R10+(R8>>26);
    R8=R9&67108863;
    R10=A[0]*B[9]+A[1]*B[8]+A[2]*B[7]+A[3]*B[6]+A[4]*B[5]+A[5]*B[4]+A[6]*B[3]+A[7]*B[2]+A[8]*B[1]+A[9]*B[0];
    R11=R10+(R0<<22)-(R1<<16)-(R6<<18)+(R7<<12);
    R0=R11+(R9>>26);
    R9=R0&67108863;
    R10=A[1]*B[9]+A[2]*B[8]+A[3]*B[7]+A[4]*B[6]+A[5]*B[5]+A[6]*B[4]+A[7]*B[3]+A[8]*B[2]+A[9]*B[1];
    R11=R10+(R1<<22)-(R2<<16)-(R7<<18)+(R8<<12);
    R1=A[2]*B[9]+A[3]*B[8]+A[4]*B[7]+A[5]*B[6]+A[6]*B[5]+A[7]*B[4]+A[8]*B[3]+A[9]*B[2];
    R10=R1+(R2<<22)-(R3<<16)-(R8<<18)+(R9<<12);
    R1=A[3]*B[9]+A[4]*B[8]+A[5]*B[7]+A[6]*B[6]+A[7]*B[5]+A[8]*B[4]+A[9]*B[3];
    R2=R1+(R3<<22)-(R4<<16)-(R9<<18);
    R1=A[4]*B[9]+A[5]*B[8]+A[6]*B[7]+A[7]*B[6]+A[8]*B[5]+A[9]*B[4];
    R3=R1+(R4<<22)-(R5<<16);
    R1=A[5]*B[9]+A[6]*B[8]+A[7]*B[7]+A[8]*B[6]+A[9]*B[5];
    R4=R1+(R5<<22)-(R6<<16);
    R1=A[6]*B[9]+A[7]*B[8]+A[8]*B[7]+A[9]*B[6];
    R5=R1+(R6<<22)-(R7<<16);
    R1=A[7]*B[9]+A[8]*B[8]+A[9]*B[7];
    R6=R1+(R7<<22)-(R8<<16);
    R1=A[8]*B[9]+A[9]*B[8];
    R7=R1+(R8<<22)-(R9<<16);
    R1=A[9]*B[9];
    R8=R1+(R9<<22);

    R1=R11+(R0>>26);    //转折
    T[0]=R1&67108863;
    R0=R10+(R1>>26);
    T[1]=R0&67108863;
    R1=R2+(R0>>26);
    T[2]=R1&67108863;
    R0=R3+(R1>>26);
    T[3]=R0&67108863;
    R1=R4+(R0>>26);
    T[4]=R1&67108863;
    R0=R5+(R1>>26);
    T[5]=R0&67108863;
    R1=R6+(R0>>26);
    T[6]=R1&67108863;
    R0=R7+(R1>>26);
    T[7]=R0&67108863;
    R1=R8+(R0>>26);
    T[8]=R1&67108863;
    T[9]=R1>>26;

    *res = T;
}

// int main()
// {
//     unsigned long *res= NULL;
//     mont_mul_opt(&res);
//     printf("R=[");
//     for(int i=0;i<9;i++){
//         printf("%lu,",T[i]);
//     }
//     printf("%lu]\n",T[9]);
// }
